{%- comment -%}
  Course Materials Page
  
  A minimal, Apple-inspired layout for displaying course content.
  Uses the modular _teaching.scss design system.
{%- endcomment -%}

{%- assign course_data = site.data.teaching.courses | where: "course_id", page.course_id | first -%}

<div class="course-wrapper">
  <div class="container-md py-4">

    <!-- Course Header -->
    <header class="course-header fade-in">
      {%- if page.description or course_data.description -%}
      <div class="course-syllabus minimal-card minimal-card--elevated" style="margin-bottom: 1.5rem;">
        <p class="course-header__desc t-body" style="margin: 0; line-height: 1.7; color: var(--global-text-color);">
          {{ page.description | default: course_data.description }}
        </p>
      </div>
      {%- endif -%}
      
      <div class="course-header__meta cluster cluster--sm">
        {%- if course_data.instructor -%}
        <span class="pill pill--accent">
          <i class="fas fa-user"></i>
          {{ course_data.instructor }}
        </span>
        {%- endif -%}
        
        {%- if course_data.semester -%}
        <span class="pill pill--muted">
          <i class="fas fa-calendar"></i>
          {{ course_data.semester }}
        </span>
        {%- endif -%}
        
        {%- if course_data.hosts and course_data.hosts.size > 0 -%}
        <span class="pill pill--muted">
          <i class="fas fa-home"></i>
          Hosts: {{ course_data.hosts | join: ", " }}
        </span>
        {%- endif -%}
        
        {%- assign tas = page.teaching_assistants | default: course_data.teaching_assistants -%}
        {%- if tas and tas.size > 0 -%}
        <span class="pill pill--muted">
          <i class="fas fa-users"></i>
          TAs: {{ tas | join: ", " }}
        </span>
        {%- endif -%}
      </div>
    </header>

    <!-- Instructor Bio Section -->
    {%- if course_data.instructor_bio or course_data.instructor_photo -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <span class="section-label__text">About the Instructor</span>
      </div>

      <div class="minimal-card minimal-card--elevated">
        <div class="instructor-profile">
          {%- if course_data.instructor_photo -%}
          <div class="instructor-profile__photo">
            {% include figure.liquid path=course_data.instructor_photo alt=course_data.instructor class="img-fluid rounded shadow" %}
            {%- if course_data.instructor -%}
            <h4 class="instructor-profile__name">{{ course_data.instructor }}</h4>
            {%- endif -%}
            {%- if course_data.instructor_links -%}
            <div class="instructor-profile__links" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; justify-content: center;">
              {%- if course_data.instructor_links.homepage -%}
              <a href="{{ course_data.instructor_links.homepage }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-sm" title="Homepage">
                <i class="fas fa-home"></i>
              </a>
              {%- endif -%}
              {%- if course_data.instructor_links.google_scholar -%}
              <a href="{{ course_data.instructor_links.google_scholar }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-sm" title="Google Scholar">
                <i class="ai ai-google-scholar"></i>
              </a>
              {%- endif -%}
              {%- if course_data.instructor_links.dblp -%}
              <a href="{{ course_data.instructor_links.dblp }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-sm" title="DBLP">
                <i class="ai ai-dblp"></i>
              </a>
              {%- endif -%}
              {%- if course_data.instructor_links.linkedin -%}
              <a href="{{ course_data.instructor_links.linkedin }}" target="_blank" rel="noopener noreferrer" class="btn btn-outline-primary btn-sm" title="LinkedIn">
                <i class="fab fa-linkedin"></i>
              </a>
              {%- endif -%}
            </div>
            {%- endif -%}
          </div>
          {%- endif -%}
          {%- if course_data.instructor_bio -%}
          <div class="instructor-profile__bio t-body">
            {{ course_data.instructor_bio }}
          </div>
          {%- endif -%}
        </div>
      </div>
    </section>
    {%- endif -%}

    <!-- Schedule Section -->
    {%- if page.schedule -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon">
          <i class="fas fa-clock"></i>
        </div>
        <span class="section-label__text">Schedule</span>
      </div>

      <div class="minimal-card minimal-card--elevated">
        <!-- Logistics Grid -->
        <div class="logistics-grid">
          {%- if page.schedule.dates_time -%}
          <div class="logistics-item">
            <span class="logistics-item__label t-overline">Date & Time</span>
            <span class="logistics-item__value t-body">{{ page.schedule.dates_time }}</span>
          </div>
          {%- endif -%}
          
          {%- if page.schedule.classroom -%}
          <div class="logistics-item">
            <span class="logistics-item__label t-overline">Classroom</span>
            <span class="logistics-item__value t-body">{{ page.schedule.classroom }}</span>
          </div>
          {%- endif -%}
          
          {%- if page.schedule.duration -%}
          <div class="logistics-item">
            <span class="logistics-item__label t-overline">Duration</span>
            <span class="logistics-item__value t-body">{{ page.schedule.duration }}</span>
          </div>
          {%- endif -%}

          {%- if page.schedule.meeting_link and page.schedule.meeting_link != "" -%}
          <div class="logistics-item">
            <span class="logistics-item__label t-overline">Meeting Link</span>
            <span class="logistics-item__value t-body"><a href="{{ page.schedule.meeting_link }}" target="_blank">Join Class</a></span>
          </div>
          {%- endif -%}
        </div>
      </div>
    </section>
    {%- endif -%}

    <!-- News/Announcements Section -->
    {%- if page.news and page.news.size > 0 -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon section-label__icon--red">
          <i class="fas fa-bullhorn"></i>
        </div>
        {%- if page.type == "Short Course" -%}
        <span class="section-label__text">Announcements</span>
        {%- else -%}
        <span class="section-label__text">News Bulletin</span>
        {%- endif -%}
      </div>

      <div class="minimal-card minimal-card--elevated">
        <div class="schedule-table-wrapper">
          <table class="schedule-table">
            <thead>
              <tr>
                <th style="width: 20%;">Date</th>
                <th style="width: 25%;">Title</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              {%- assign sorted_news = page.news | sort: "date" | reverse -%}
              {%- for item in sorted_news -%}
              <tr>
                <td>{{ item.date | date: "%B %-d, %Y" }}</td>
                <td>
                  {%- if item.link -%}
                  <a href="{{ item.link }}" target="_blank">{{ item.title }} <i class="fas fa-external-link-alt fa-xs"></i></a>
                  {%- else -%}
                  {{ item.title }}
                  {%- endif -%}
                </td>
                <td>{{ item.description | markdownify }}</td>
              </tr>
              {%- endfor -%}
            </tbody>
          </table>
        </div>
      </div>
    </section>
    {%- endif -%}

    <!-- Modules Section -->
    {%- if page.modules and page.modules.size > 0 -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon section-label__icon--blue">
          <i class="fas fa-cubes"></i>
        </div>
        <span class="section-label__text">Course Modules</span>
      </div>

      <div class="teaching-grid teaching-grid--materials">
        {%- for mod in page.modules -%}
        <article class="material-card material-card--lecture minimal-card">
          <div class="material-card__content">
            <h4 class="material-card__title t-title">{{ mod.title }}</h4>
            {%- if mod.description -%}
            <p class="material-card__desc t-body">{{ mod.description }}</p>
            {%- endif -%}
            {%- if mod.lectures -%}
            <p class="material-card__meta t-overline"><i class="fas fa-chalkboard"></i> {{ mod.lectures }}</p>
            {%- endif -%}
            {%- if mod.status -%}
            <span class="pill {% if mod.status == 'Completed' %}pill--success{% elsif mod.status == 'In Progress' %}pill--accent{% else %}pill--muted{% endif %}">
              {{ mod.status }}
            </span>
            {%- endif -%}
          </div>
          
          <div class="material-card__actions">
            {%- if mod.link and mod.status != 'Upcoming' -%}
            <a href="{{ mod.link | relative_url }}" class="btn-minimal btn-minimal--primary">
              <i class="fas fa-arrow-right"></i>
              <span>View Module</span>
            </a>
            {%- elsif mod.status == 'Upcoming' -%}
            <span class="btn-minimal btn-minimal--disabled" style="opacity: 0.5; cursor: not-allowed;">
              <i class="fas fa-clock"></i>
              <span>Coming Soon</span>
            </span>
            {%- endif -%}
          </div>
        </article>
        {%- endfor -%}
      </div>
    </section>
    {%- endif -%}

    <!-- Schedule Table Details (if any) -->
    {%- if page.schedule_details -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon">
          <i class="fas fa-list-ol"></i>
        </div>
        <span class="section-label__text">Class Schedule</span>
      </div>

      <div class="minimal-card minimal-card--elevated">
        <!-- Schedule Table -->
        <div class="schedule-table-wrapper">
          <table class="schedule-table">
            <thead>
              <tr>
                <th>No.</th>
                <th>Date</th>
                <th>Topic / Venue</th>
              </tr>
            </thead>
            <tbody>
              {%- for session in page.schedule_details -%}
              <tr>
                <td><span class="lecture-num">#{{ session.lecture }}</span></td>
                <td>{{ session.date }}</td>
                <td>{{ session.venue }}</td>
              </tr>
              {%- endfor -%}
            </tbody>
          </table>
        </div>
      </div>
    </section>
    {%- endif -%}

    <!-- Lectures Section -->
    {%- if page.lectures and page.lectures.size > 0 -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon section-label__icon--blue">
          <i class="fas fa-book-open"></i>
        </div>
        <span class="section-label__text">Lectures</span>
      </div>

      <div class="teaching-grid teaching-grid--materials">
        {%- for lecture in page.lectures -%}
        <article class="material-card material-card--lecture minimal-card">
          <div class="material-card__content">
            <h4 class="material-card__title t-title">{{ lecture.title }}</h4>
            {%- if lecture.description -%}
            <p class="material-card__desc t-body">{{ lecture.description }}</p>
            {%- endif -%}
          </div>
          
          <div class="material-card__actions">
            {%- if lecture.slides -%}
            <a href="{{ lecture.slides }}" class="btn-minimal btn-minimal--ghost" target="_blank">
              <i class="fas fa-desktop"></i> Slides
            </a>
            {%- endif -%}
            {%- if lecture.video and lecture.video != blank -%}
            <a href="{{ lecture.video }}" class="btn-minimal btn-minimal--ghost" target="_blank">
              <i class="fas fa-play"></i> Video
            </a>
            {%- endif -%}
            {%- if lecture.notes and lecture.notes != blank -%}
            <a href="{{ lecture.notes }}" class="btn-minimal btn-minimal--ghost" target="_blank">
              <i class="fas fa-sticky-note"></i> Notes
            </a>
            {%- endif -%}
          </div>
        </article>
        {%- endfor -%}
      </div>
    </section>
    {%- endif -%}

    <!-- Assignments Section -->
    {%- if page.assignments and page.assignments.size > 0 -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon section-label__icon--green">
          <i class="fas fa-pencil-ruler"></i>
        </div>
        <span class="section-label__text">Assignments</span>
      </div>

      <div class="teaching-grid teaching-grid--materials">
        {%- for assignment in page.assignments -%}
        <article class="material-card material-card--assignment minimal-card">
          <div class="material-card__content">
            <h4 class="material-card__title t-title">{{ assignment.title }}</h4>
            {%- if assignment.description -%}
            <p class="material-card__desc t-body">{{ assignment.description }}</p>
            {%- endif -%}
            {%- if assignment.due_date -%}
            <div class="material-card__due">
              <i class="far fa-clock"></i>
              Due: {{ assignment.due_date | date: "%B %-d, %Y" }}
            </div>
            {%- endif -%}
          </div>
          
          <div class="material-card__actions">
            {%- if assignment.pdf -%}
            <a href="{{ assignment.pdf }}" class="btn-minimal btn-minimal--subtle" target="_blank">
              <i class="far fa-file-pdf"></i> PDF
            </a>
            {%- endif -%}
            {%- if assignment.solution -%}
            <a href="{{ assignment.solution }}" class="btn-minimal btn-minimal--ghost" target="_blank">
              <i class="fas fa-check"></i> Solution
            </a>
            {%- endif -%}
          </div>
        </article>
        {%- endfor -%}
      </div>
    </section>
    {%- endif -%}

    <!-- Resources Section -->
    {%- if page.resources and page.resources.size > 0 -%}
    <section class="content-section fade-in">
      <div class="section-label">
        <div class="section-label__icon section-label__icon--purple">
          <i class="fas fa-layer-group"></i>
        </div>
        <span class="section-label__text">Resources</span>
      </div>

      <div class="teaching-grid teaching-grid--materials">
        {%- for resource in page.resources -%}
        <article class="material-card material-card--resource minimal-card">
          <div class="material-card__content">
            <h4 class="material-card__title t-title">{{ resource.title }}</h4>
            {%- if resource.description -%}
            <p class="material-card__desc t-body">{{ resource.description }}</p>
            {%- endif -%}
          </div>
          
          <div class="material-card__actions">
            <a href="{{ resource.url }}" class="btn-minimal btn-minimal--primary" target="_blank">
              <i class="fas fa-external-link-alt"></i> Open Resource
            </a>
          </div>
        </article>
        {%- endfor -%}
      </div>
    </section>
    {%- endif -%}

    <!-- Back Navigation -->
    <nav class="course-nav">
      <a href="/teaching/" class="btn-minimal btn-minimal--ghost">
        <i class="fas fa-arrow-left"></i>
        Back to All Courses
      </a>
    </nav>

  </div>
</div>