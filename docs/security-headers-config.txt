# Security Headers Configuration for IISc IT Team
# ================================================
# 
# This file contains server configurations to add security headers
# for the Spectrum Lab website when using an IISc subdomain.
#
# Choose the configuration based on your server type.

# ============================================================================
# NGINX CONFIGURATION
# ============================================================================
# Add this to your server block for spectrumlab.iisc.ac.in

server {
    listen 443 ssl http2;
    server_name spectrumlab.iisc.ac.in;
    
    # SSL Configuration - Use your IISc certificates
    ssl_certificate /path/to/your/certificate.crt;
    ssl_certificate_key /path/to/your/private.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # Proxy to GitHub Pages
    location / {
        proxy_pass https://spectrum-lab-iisc.github.io;
        proxy_set_header Host spectrum-lab-iisc.github.io;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_ssl_server_name on;
        
        # ==========================================
        # SECURITY HEADERS (Required for VAPT)
        # ==========================================
        
        # 1. HSTS - Force HTTPS for 2 years
        add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
        
        # 2. Prevent Clickjacking
        add_header X-Frame-Options "SAMEORIGIN" always;
        
        # 3. Prevent MIME-type sniffing
        add_header X-Content-Type-Options "nosniff" always;
        
        # 4. XSS Protection
        add_header X-XSS-Protection "1; mode=block" always;
        
        # 5. Referrer Policy
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        
        # 6. Permissions Policy
        add_header Permissions-Policy "camera=(), microphone=(), geolocation=(), interest-cohort=()" always;
        
        # 7. Content Security Policy
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://use.typekit.net https://giscus.app https://www.googletagmanager.com https://www.google-analytics.com https://google-analytics.com https://tikzjax.com https://distill.pub https://maps.googleapis.com https://maps.gstatic.com https://unpkg.com https://ajax.googleapis.com https://cdn.scite.ai; style-src 'self' 'unsafe-inline' https:; font-src 'self' data: https:; img-src 'self' data: blob: https: http:; connect-src 'self' https://api.github.com https://giscus.app https://www.google-analytics.com https://google-analytics.com https://fonts.googleapis.com https://fonts.gstatic.com https://cdn.jsdelivr.net https://distill.pub https://maps.googleapis.com https://maps.gstatic.com https://unpkg.com https://ajax.googleapis.com wss: ws:; frame-src 'self' https://giscus.app https://www.youtube.com https://youtube.com https://player.vimeo.com https://www.google.com https://maps.google.com https://codepen.io https://jsfiddle.net; media-src 'self' blob: data:; object-src 'none'; base-uri 'self'; form-action 'self' https://giscus.app; frame-ancestors 'self'; upgrade-insecure-requests;" always;
    }
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name spectrumlab.iisc.ac.in;
    return 301 https://$server_name$request_uri;
}


# ============================================================================
# APACHE CONFIGURATION
# ============================================================================
# Add this to your Apache virtual host configuration

<VirtualHost *:443>
    ServerName spectrumlab.iisc.ac.in
    
    # SSL Configuration - Use your IISc certificates
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    
    # Enable required modules: mod_proxy, mod_proxy_http, mod_headers, mod_ssl
    
    # Proxy Configuration
    ProxyPreserveHost Off
    ProxyPass / https://spectrum-lab-iisc.github.io/
    ProxyPassReverse / https://spectrum-lab-iisc.github.io/
    SSLProxyEngine on
    
    # ==========================================
    # SECURITY HEADERS (Required for VAPT)
    # ==========================================
    
    # 1. HSTS - Force HTTPS for 2 years
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    
    # 2. Prevent Clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # 3. Prevent MIME-type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # 4. XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # 5. Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # 6. Permissions Policy
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(), interest-cohort=()"
    
    # 7. Content Security Policy
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://use.typekit.net https://giscus.app https://www.googletagmanager.com https://www.google-analytics.com https://google-analytics.com https://tikzjax.com https://distill.pub https://maps.googleapis.com https://maps.gstatic.com https://unpkg.com https://ajax.googleapis.com https://cdn.scite.ai; style-src 'self' 'unsafe-inline' https:; font-src 'self' data: https:; img-src 'self' data: blob: https: http:; connect-src 'self' https://api.github.com https://giscus.app https://www.google-analytics.com https://google-analytics.com https://fonts.googleapis.com https://fonts.gstatic.com https://cdn.jsdelivr.net https://distill.pub https://maps.googleapis.com https://maps.gstatic.com https://unpkg.com https://ajax.googleapis.com wss: ws:; frame-src 'self' https://giscus.app https://www.youtube.com https://youtube.com https://player.vimeo.com https://www.google.com https://maps.google.com https://codepen.io https://jsfiddle.net; media-src 'self' blob: data:; object-src 'none'; base-uri 'self'; form-action 'self' https://giscus.app; frame-ancestors 'self'; upgrade-insecure-requests;"
</VirtualHost>

# Redirect HTTP to HTTPS
<VirtualHost *:80>
    ServerName spectrumlab.iisc.ac.in
    Redirect permanent / https://spectrumlab.iisc.ac.in/
</VirtualHost>


# ============================================================================
# CLOUDFLARE TRANSFORM RULES (Alternative)
# ============================================================================
# If using Cloudflare, add these headers via Transform Rules:
# 
# Go to: Rules > Transform Rules > Modify Response Header
# 
# Add the following headers:
# 
# Header Name                    | Value
# ------------------------------|-----------------------------------------------
# Strict-Transport-Security     | max-age=63072000; includeSubDomains; preload
# X-Frame-Options               | SAMEORIGIN
# X-Content-Type-Options        | nosniff
# X-XSS-Protection              | 1; mode=block
# Referrer-Policy               | strict-origin-when-cross-origin
# Permissions-Policy            | camera=(), microphone=(), geolocation=(), interest-cohort=()
# Content-Security-Policy       | [See full CSP above]


# ============================================================================
# VERIFICATION
# ============================================================================
# After implementing, verify headers using:
# 
# 1. curl -I https://spectrumlab.iisc.ac.in
# 
# 2. Online tools:
#    - https://securityheaders.com
#    - https://observatory.mozilla.org
#
# Expected output should show all headers with grade A or A+
